<!DOCTYPE html>
<html>
<meta charset="utf-8" />

<head>
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />

    <style>
        #map {
            width: 100vw;
            height: 100vh;
        }
        body{
            margin: 0 !important;
        }
    </style>

</head>

<body>
    <div id="map"></div>
    <script>

        const BIKEPATH =
        "./../data/Ciclorruta.geojson";


        var map = L.map('map').
        setView([ 4.5980800, -74.0760439],
            13);

        function loadJSON(path, success, error) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        if (success)
                            success(JSON.parse(xhr.responseText));
                    } else {
                        if (error)
                            error(xhr);
                    }
                }
            };
            xhr.open("GET", path, true);
            xhr.send();
        }

        L.tileLayer('https://tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=31e5cca6ebd249ce9c40dc5dd7aecd10', {
            /*Atribution is editable*/
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
            maxZoom: 18
        }).addTo(map);

        L.control.scale().addTo(map);

        var marker = 
            L.marker([4.5980800, -74.0760439], {
                draggable: true
            }).addTo(map);


        marker.on('dragend', function (e) {
            // Send data marker to the parent node on drag the marker
            const message = JSON.stringify({
                latitude: marker.getLatLng().lat,
                longitude: marker.getLatLng().lng,
            });
            window.parent.postMessage(message, '*');
        });
  

        loadJSON(BIKEPATH,
            function (data) {
                console.log(data);
                L.geoJSON(data, {

                }).bindPopup(function (layer) {
                    return layer.feature.properties.description;
                }).addTo(map)
            },
            function (xhr) {
                console.error(xhr);
            },


        );
    </script>
</body>

</html>